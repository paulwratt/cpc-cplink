0000                             ; fifo_in_bytes_nc
0000                             ; 
0000                             ; Read up to 255 bytes from the FIFO ignoring FIFO status
0000                             ; flag states.
0000                             ; .
0000                             ; Entry:
0000                             ;  max      IX+127/6 - Param 2: MAX bytes to write
0000                             ;  @rxptr   IX+125/4 - Param 1: ptr to first byte in buffer
0000                             ;  ret addr IX+123/2
0000                             ;  old IX   IX+121/0
0000                             ;  vec ptr  IX+119/8
0000                             ;  f        IX+117/6 - local var init to 0 used to return result
0000   DD 66 7D               LD   h,(ix+125)   ; HL points to RX buffer
0003   DD 6E 7C               LD   l,(ix+124)   
0006   11 00 00               LD   de,00000   ; e = sent byte count
0009   01 80 FD               LD   bc,0xfd80   ; point to data register directly
000C   DD 7E 7F               LD   a,(ix+127)   ; get high byte of count
000F   E6 FF                  AND   0xFF   ; check if non-zero
0011   28 08                  JR   z,next   ; get low byte if zero
0013   17                     RLA      ; check sign bit
0014   38 14                  JR   c,end   ; exit if sign bit is set
0016   16 FF                  LD   d,255   ; else, +ve, non-zero hi byte so set size to 255 max
0018   5A                     LD   e,d   
0019   18 09                  JR   top   
001B                NEXT:        
001B   DD 7E 7E               LD   a,(ix+126)   ; Max bytes (1..255)
001E   E6 FF                  AND   0xff   ; check for zero and exit early
0020   28 08                  JR   Z,end   
0022   57                     LD   d,a   ; d = max bytes
0023   5F                     LD   e,a   ; e = max bytes
0024                TOP:         
0024   ED A2                  INI      ; (HL)<-IN(bc), HL++, B--
0026   04                     INC   b   ; restore B
0027   1D                     DEC   e   
0028   20 FA                  JR   nz,top   ; if not loop again
002A                END:         
002A   DD 72 74               LD   (ix+116),d   ; write num bytes ready to exit
